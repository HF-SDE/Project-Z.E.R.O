stream {
    upstream mqtt_ssl {
        hash $remote_addr consistent;
        server mosquitto:8080;
    }

    server {
        listen 8080;
        listen [::]:8080;
        server_name mqttsss.exploit4all.com;

        proxy_pass mqtt_ssl;
    }

    upstream mqtt {
        hash $remote_addr consistent;
        server mosquitto:1883;
    }

    server {
        listen 1883;
        listen [::]:1883;
        server_name mqttsss.exploit4all.com;

        proxy_pass mqtt;
    }
    
}
