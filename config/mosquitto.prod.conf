# =========================
# Core
# =========================
per_listener_settings true

persistence true
persistence_location /mosquitto/data/

log_dest file /mosquitto/log/mosquitto.log
log_type all
log_timestamp true

# =========================
# Listeners
# =========================

# Internal MQTT (Docker only)
listener 1883
protocol mqtt
allow_anonymous false

# WebSockets (behind Nginx)
listener 9001
protocol websockets
allow_anonymous false

# Secure MQTT (TLS)
listener 8883
protocol mqtt
allow_anonymous false

cafile /mosquitto/certs/ca.pem
certfile /mosquitto/certs/server.pem
keyfile /mosquitto/certs/server.key
tls_version tlsv1.2

# =========================
# Dynamic Security
# =========================
plugin /usr/lib/mosquitto_dynamic_security.so
plugin_opt_config_file /mosquitto/data/dynamic-security.json
